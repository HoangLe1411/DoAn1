@model PagedList.Core.IPagedList<DoAn1.Areas.Admin.Models.Product>
@{
    ViewData["Title"] = "Tất Cả Sản Phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/products.css" />
}

<div class="container mt-4">
    <h2 class="mb-4">Tất Cả Sản Phẩm</h2>

    <!-- Bộ lọc -->
    <form id="filterForm" method="get" class="filter-bar mb-4">
        <span><i class="bi bi-funnel"></i> Lọc:</span>

        <select name="location" class="form-select d-inline-block w-auto ms-2">
            <option value="">-- Địa điểm --</option>
            <option value="Toàn quốc" selected="@(ViewBag.Location == "Toàn quốc" ? "selected" : null)">Toàn quốc</option>
            <option value="Hà Nội" selected="@(ViewBag.Location == "Hà Nội" ? "selected" : null)">Hà Nội</option>
            <option value="TP. Hồ Chí Minh" selected="@(ViewBag.Location == "TP. Hồ Chí Minh" ? "selected" : null)">TP. Hồ Chí Minh</option>
            <option value="Cần Thơ" selected="@(ViewBag.Location == "Cần Thơ" ? "selected" : null)">Cần Thơ</option>
        </select>

        <select name="category" class="form-select d-inline-block w-auto ms-2">
            <option value="">-- Danh mục --</option>
            <option value="Đồ điện tử" selected="@(ViewBag.Category == "Đồ điện tử" ? "selected" : null)">Đồ điện tử</option>
            <option value="Đồ gia dụng" selected="@(ViewBag.Category == "Đồ gia dụng" ? "selected" : null)">Đồ gia dụng</option>
            <option value="Thời trang" selected="@(ViewBag.Category == "Thời trang" ? "selected" : null)">Thời trang</option>
            <option value="Mẹ và bé" selected="@(ViewBag.Category == "Mẹ và bé" ? "selected" : null)">Mẹ & Bé</option>
            <option value="Xe cộ" selected="@(ViewBag.Category == "Xe cộ" ? "selected" : null)">Xe cộ</option>
            <option value="Sách" selected="@(ViewBag.Category == "Sách" ? "selected" : null)">Sách</option>
            <option value="Thể thao & giải trí" selected="@(ViewBag.Category == "Thể thao & giải trí" ? "selected" : null)">Thể thao & Giải trí</option>
            <option value="Văn phòng" selected="@(ViewBag.Category == "Văn phòng" ? "selected" : null)">Văn phòng</option>
            <option value="Đồ khác" selected="@(ViewBag.Category == "Đồ khác" ? "selected" : null)">Đồ khác</option>
        </select>

        <select name="price" class="form-select d-inline-block w-auto ms-2">
            <option value="">-- Giá --</option>
            <option value="0-1000000" selected="@(ViewBag.Price == "0-1000000" ? "selected" : null)">Dưới 1 triệu</option>
            <option value="1000000-5000000" selected="@(ViewBag.Price == "1000000-5000000" ? "selected" : null)">1 - 5 triệu</option>
            <option value="5000000-10000000" selected="@(ViewBag.Price == "5000000-10000000" ? "selected" : null)">5 - 10 triệu</option>
            <option value="10000000-999999999" selected="@(ViewBag.Price == "10000000-999999999" ? "selected" : null)">Trên 10 triệu</option>
        </select>

        <select name="condition" class="form-select d-inline-block w-auto ms-2">
            <option value="">-- Tình trạng --</option>
            <option value="new" selected="@(ViewBag.Condition == "new" ? "selected" : null)">Mới</option>
            <option value="used" selected="@(ViewBag.Condition == "used" ? "selected" : null)">Đã sử dụng</option>
        </select>

        <button type="submit" class="btn btn-primary ms-2">Lọc</button>
    </form>


    <div class="row product-row">
        @foreach (var product in Model)
        {
            var imageUrl = product.ProductImages.FirstOrDefault()?.ImageUrl ?? "/images/no-image.png";
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card h-100">
                    <img src="@imageUrl" class="card-img-top" alt="@product.Title">
                    <div class="card-body">
                        <h5 class="card-title">@product.Title</h5>
                        <p class="card-text">@string.Format("{0:N0} đ", product.Price)</p>
                        <a href="@Url.Action("DetailProduct", "Products", new { id = product.ProductId })"
                           class="btn btn-outline-primary w-100">Xem chi tiết</a>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Phân trang -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            @if (Model.HasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("AllProducts", new { page = Model.PageNumber - 1, location = ViewBag.Location, category = ViewBag.Category, price = ViewBag.Price, condition = ViewBag.Condition })">«</a>
                </li>
            }
            @for (int i = 1; i <= Model.PageCount; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link" href="@Url.Action("AllProducts", new { page = i, location = ViewBag.Location, category = ViewBag.Category, price = ViewBag.Price, condition = ViewBag.Condition })">@i</a>
                </li>
            }
            @if (Model.HasNextPage)
            {
                <li class="page-item">
                    <a class="page-link" href="@Url.Action("AllProducts", new { page = Model.PageNumber + 1, location = ViewBag.Location, category = ViewBag.Category, price = ViewBag.Price, condition = ViewBag.Condition })">»</a>
                </li>
            }
        </ul>
    </nav>
</div>
